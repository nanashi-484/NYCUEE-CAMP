#include "Global_define.h"
#include <Wire.h>
#include <U8g2lib.h>

// OLED 使用硬體 I2C（節省記憶體的 page buffer 模式）
U8G2_SSD1306_128X64_NONAME_1_HW_I2C u8g2(U8G2_R0, /* reset=*/U8X8_PIN_NONE);

// 外部定義
#define logo_width 128
#define logo_height 64
const unsigned char logo_bits[] U8X8_PROGMEM = {
    0X00,
    0X01,
    0X40,
    0X00,
    0X40,
    0X00,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0X7F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0X0F,
    0XEF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0X9F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XC3,
    0X9F,
    0XFF,
    0XBF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0X9F,
    0XBF,
    0XFF,
    0XBF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XBF,
    0XBF,
    0XFF,
    0XB8,
    0X03,
    0XC3,
    0XC1,
    0XC3,
    0XFB,
    0XBF,
    0XC3,
    0XBB,
    0XFF,
    0X9F,
    0X9F,
    0X9F,
    0XFB,
    0XBF,
    0X9F,
    0XBB,
    0XFF,
    0XFF,
    0XBF,
    0XBF,
    0XE7,
    0XBF,
    0XBF,
    0XBB,
    0XBB,
    0XDF,
    0XBB,
    0XBF,
    0XCF,
    0XBF,
    0XBF,
    0XBB,
    0XBB,
    0X9F,
    0XBB,
    0XBF,
    0X9F,
    0XBF,
    0XBF,
    0XBB,
    0XBB,
    0XBF,
    0XBB,
    0XB9,
    0XBF,
    0XBF,
    0XB9,
    0XBB,
    0XBB,
    0XFB,
    0XFB,
    0XFB,
    0XB9,
    0XB8,
    0XFB,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0X9F,
    0XAF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF3,
    0XC7,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XDF,
    0XC7,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0X3F,
    0X0F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF3,
    0X80,
    0X8E,
    0X3F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XE1,
    0X01,
    0X10,
    0X1F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XC0,
    0X01,
    0X10,
    0X0F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XE0,
    0X02,
    0X20,
    0X0F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF0,
    0X0E,
    0X20,
    0X3F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XD0,
    0X3C,
    0X60,
    0X2F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XE0,
    0X7C,
    0X78,
    0X2F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XA0,
    0XF8,
    0XFC,
    0X17,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XA0,
    0XF8,
    0XFC,
    0X17,
    0XFF,
    0XFF,
    0XFF,
    0XFE,
    0X01,
    0XF1,
    0XFE,
    0X1F,
    0XFF,
    0XFF,
    0XFF,
    0XFE,
    0X01,
    0XF0,
    0X1E,
    0X01,
    0XFF,
    0XFF,
    0XFF,
    0XFE,
    0X01,
    0XE0,
    0X1E,
    0X01,
    0XFF,
    0XFF,
    0XFF,
    0XFE,
    0X01,
    0XE0,
    0X3E,
    0X01,
    0XFF,
    0XFF,
    0XFF,
    0XFE,
    0X01,
    0XFC,
    0X7E,
    0X01,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XC1,
    0XFC,
    0X7E,
    0X1F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XA1,
    0XF8,
    0XFE,
    0X17,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XA0,
    0XF9,
    0XFC,
    0X17,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XD0,
    0XF1,
    0XF8,
    0X2F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XD0,
    0X73,
    0XF0,
    0X2F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF8,
    0X03,
    0XE0,
    0X3F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XE0,
    0X27,
    0X00,
    0X1F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XE0,
    0X28,
    0X00,
    0X1F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF0,
    0X48,
    0X00,
    0X3F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF9,
    0XD0,
    0X0C,
    0X7F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF8,
    0X27,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XB8,
    0X3F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF8,
    0X3F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0X7F,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XF5,
    0X50,
    0X19,
    0X39,
    0XB2,
    0X8F,
    0XFF,
    0XFF,
    0XF1,
    0X06,
    0X1B,
    0X73,
    0X10,
    0XAF,
    0XFF,
    0XFF,
    0XF1,
    0XA6,
    0X1B,
    0X73,
    0X10,
    0X9F,
    0XFF,
    0XFF,
    0XF5,
    0XB1,
    0X39,
    0X38,
    0X54,
    0XBF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
    0XFF,
};

// OLED初始設定
void setupOLED()
{
  Wire.begin();
  u8g2.begin();
  // 顯示Logo（全屏）
  u8g2.firstPage();
  do
  {
    u8g2.drawXBMP(0, 0, logo_width, logo_height, logo_bits);
  } while (u8g2.nextPage());

  delay(3000); // 顯示3秒
  u8g2.setFont(u8g2_font_ncenB08_tr);
}

// 顯示 OLED 畫面
void updateOLED()
{
  const char *labels[] = {"1-dollar", "5-dollar", "10-dollar", "50-dollar"};
  char buffer[20];

  u8g2.firstPage();
  do
  {
    u8g2.setFont(u8g2_font_helvB14_tr);

    for (int i = 0; i < 4; i++)
    {
      snprintf(buffer, sizeof(buffer), "%s: %d", labels[i], CoinActive[i]);
      u8g2.drawStr(0, 15 + i * 15, buffer);
    }
  } while (u8g2.nextPage());
}
